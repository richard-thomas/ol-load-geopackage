{"version":3,"file":"basic-ImMy-kN3.js","sources":["../../src/basic_example.js"],"sourcesContent":["// ol-load-geopackage basic demo\n//\n// Load vector tables (and optionally QGIS \"layer_styles\" SLD XML strings)\n// from an OGC GeoPackage and render all tables as layers on an OpenLayers map.\n// Display details of package contents.\n// (Geopackage URL (gpkgFile) and initialMapExtent must be defined beforehand)\n\n// ESLint settings:\n/* global gpkgFile, initialMapExtent */\n\nimport 'ol/ol.css';\n\n// OpenLayers 8.2+ modules\nimport {get as ol_proj_get} from 'ol/proj.js';\nimport ol_Map from 'ol/Map.js';\nimport ol_View from 'ol/View.js';\nimport ol_layer_Vector from 'ol/layer/Vector.js';\nimport ol_layer_Tile from 'ol/layer/Tile.js';\nimport ol_source_StadiaMaps from 'ol/source/StadiaMaps.js';\n\n// Module to import OGC GeoPackages\nimport { initSqlJsWasm, loadGpkg } from 'ol-load-geopackage';\n\n// Start loading of sql.js Web Assembly (WASM) from current folder\ninitSqlJsWasm('.');\n\n// Map View Projection\nconst displayProjection = 'EPSG:3857';\n\n// Check if we need to add Proj4s definition for requested display projection\nif (!ol_proj_get(displayProjection)) {\n    alert('Missing requested display projection [' +\n        displayProjection + '] - this can be added with proj4.defs');\n}\n\nconst outputElem = document.getElementById('report');\n\noutputElem.innerHTML +=\n    '<p>Loading OGC GeoPackage file (' + gpkgFile +\n    ') and reprojecting sources (to ' + displayProjection + ')...</p>';\n\n// Kick off the loading of the OGC GeoPackage\nvar startProcessing = Date.now();\n\nvar gpkgPromise;\ntry {\n    gpkgPromise = loadGpkg(gpkgFile, displayProjection);\n} catch (error) {\n    alert('loadGpkg() failed before Promise set-up:\\n' + error);\n}\n\n// Create Map canvas and View\nvar map = new ol_Map({\n    target: 'map',\n    layers: [\n        new ol_layer_Tile({\n            source: new ol_source_StadiaMaps({ layer: 'stamen_toner_lite' })\n        }),\n      ],\n    view: new ol_View({\n        projection: displayProjection,\n        maxZoom: 28,\n        minZoom: 1\n    })\n});\nvar mapView = map.getView();\nmapView.fit(initialMapExtent, map.getSize());\n\n// Display data when GeoPackage load is complete\ngpkgPromise\n    .then(([dataFromGpkg, sldsFromGpkg]) => {\n        var processingSecs = (Date.now() - startProcessing) / 1000;\n        outputElem.innerHTML +=\n            '<p>...loading, data extraction and reprojection completed in ' +\n            processingSecs + ' seconds.</p>';\n        displayGpkgContents(dataFromGpkg, sldsFromGpkg);\n\n        // Add all vector layers found to map (with default styling)\n        for (var table in dataFromGpkg) {\n            map.addLayer(new ol_layer_Vector({\n                source: dataFromGpkg[table],\n            }));\n        }\n    })\n    .catch(error => alert('ol-load-geopackage loadGpkg() error:\\n' + error));\n\n// Display (in browser console) details of all tables in GeoPackage\nfunction displayGpkgContents(dataFromGpkg, sldsFromGpkg) {\n    var tablesText = '<p>Details extracted for each table { ' +\n        '\"table name\" [original projection]: (attribute names) }:</p><ul>';\n    for (var table in dataFromGpkg) {\n        tablesText += '<li>\"' + table + '\" [' +\n            dataFromGpkg[table].getProperties()[\"origProjection\"] + ']: (';\n\n        // Attribute names are stored as Feature \"Properties\":\n        // list them for first feature in each table\n        var properties = dataFromGpkg[table].getFeatures()[0].getProperties();\n        tablesText += Object.keys(properties).join(', ') + ')</li>';\n    }\n    outputElem.innerHTML += tablesText + '</ul>';\n\n    // Display SLD strings (if \"layer_styles\" was found in gpkg)\n    if (Object.keys(sldsFromGpkg).length) {\n        console.log('Raw SLD XML strings for each layer (\"layer_styles\" table):');\n        console.log(sldsFromGpkg);\n        //for (var layer in sldsFromGpkg) {\n        //    console.log('\"' + layer + '\": ' + sldsFromGpkg[layer]);\n        //}\n        outputElem.innerHTML +=\n            '<p>(Raw SLD XML strings for each layer are shown in browser console.)<p>';\n    }\n}\n"],"names":["initSqlJsWasm","displayProjection","ol_proj_get","outputElem","startProcessing","gpkgPromise","loadGpkg","error","map","ol_Map","ol_layer_Tile","ol_source_StadiaMaps","ol_View","mapView","dataFromGpkg","sldsFromGpkg","processingSecs","displayGpkgContents","table","ol_layer_Vector","tablesText","properties"],"mappings":"sGAwBAA,EAAc,GAAG,EAGjB,MAAMC,EAAoB,YAGrBC,EAAYD,CAAiB,GAC9B,MAAM,yCACFA,EAAoB,uCAAuC,EAGnE,MAAME,EAAa,SAAS,eAAe,QAAQ,EAEnDA,EAAW,WACP,mCAAqC,SACrC,kCAAoCF,EAAoB,WAG5D,IAAIG,EAAkB,KAAK,IAAG,EAE1BC,EACJ,GAAI,CACAA,EAAcC,EAAS,SAAUL,CAAiB,CACtD,OAASM,EAAO,CACZ,MAAM;AAAA,EAA+CA,CAAK,CAC9D,CAGA,IAAIC,EAAM,IAAIC,EAAO,CACjB,OAAQ,MACR,OAAQ,CACJ,IAAIC,EAAc,CACd,OAAQ,IAAIC,EAAqB,CAAE,MAAO,mBAAmB,CAAE,CAC3E,CAAS,CACT,EACI,KAAM,IAAIC,EAAQ,CACd,WAAYX,EACZ,QAAS,GACT,QAAS,CACjB,CAAK,CACL,CAAC,EACGY,EAAUL,EAAI,QAAO,EACzBK,EAAQ,IAAI,iBAAkBL,EAAI,QAAO,CAAE,EAG3CH,EACK,KAAK,CAAC,CAACS,EAAcC,CAAY,IAAM,CACpC,IAAIC,GAAkB,KAAK,IAAG,EAAKZ,GAAmB,IACtDD,EAAW,WACP,gEACAa,EAAiB,gBACrBC,EAAoBH,EAAcC,CAAY,EAG9C,QAASG,KAASJ,EACdN,EAAI,SAAS,IAAIW,EAAgB,CAC7B,OAAQL,EAAaI,CAAK,CAC1C,CAAa,CAAC,CAEV,CAAC,EACA,MAAMX,GAAS,MAAM;AAAA,EAA2CA,CAAK,CAAC,EAG3E,SAASU,EAAoBH,EAAcC,EAAc,CACrD,IAAIK,EAAa,yGAEjB,QAASF,KAASJ,EAAc,CAC5BM,GAAc,QAAUF,EAAQ,MAC5BJ,EAAaI,CAAK,EAAE,cAAa,EAAG,eAAoB,OAI5D,IAAIG,EAAaP,EAAaI,CAAK,EAAE,cAAc,CAAC,EAAE,cAAa,EACnEE,GAAc,OAAO,KAAKC,CAAU,EAAE,KAAK,IAAI,EAAI,QACvD,CACAlB,EAAW,WAAaiB,EAAa,QAGjC,OAAO,KAAKL,CAAY,EAAE,SAC1B,QAAQ,IAAI,4DAA4D,EACxE,QAAQ,IAAIA,CAAY,EAIxBZ,EAAW,WACP,2EAEZ"}